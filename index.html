<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GM on Unichain</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
    }
    button {
      margin: 10px;
      padding: 10px 20px;
      font-size: 16px;
    }
    #status {
      margin-top: 20px;
      color: green;
    }
  </style>
</head>
<body>
  <h1>GM on Unichain</h1>
  <button onclick="connectWallet()">Connect Rabby/Metamask</button>
  <button onclick="callGM()">GM</button>
  <div id="status"></div>

  <script>
    const contractAddress = "0x3f183B283fdA263B3F868A30602474CD9f555B15";
    const unichain = {
      chainId: 747,
      chainName: "Unichain",
      rpcUrls: ["https://uni-rpc.meson.network"],
      nativeCurrency: {
        name: "Unichain",
        symbol: "UNI",
        decimals: 18
      },
      blockExplorerUrls: ["https://unichain.blockscout.com"]
    };

    const abi = ["function gm() public"];

    let signer;

    async function connectWallet() {
      if (!window.ethereum) {
        alert("Please install Rabby or MetaMask");
        return;
      }

      try {
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        document.getElementById("status").innerText = "Wallet connected";

        // Try to switch or add Unichain
        try {
          await window.ethereum.request({
            method: 'wallet_switchEthereumChain',
            params: [{ chainId: ethers.utils.hexValue(unichain.chainId) }]
          });
        } catch (err) {
          if (err.code === 4902) {
            await window.ethereum.request({
              method: 'wallet_addEthereumChain',
              params: [{
                chainId: ethers.utils.hexValue(unichain.chainId),
                chainName: unichain.chainName,
                rpcUrls: unichain.rpcUrls,
                nativeCurrency: unichain.nativeCurrency,
                blockExplorerUrls: unichain.blockExplorerUrls
              }]
            });
          } else {
            throw err;
          }
        }
      } catch (error) {
        console.error(error);
        document.getElementById("status").innerText = `Connection failed: ${error.message}`;
      }
    }

    async function callGM() {
      if (!signer) {
        document.getElementById("status").innerText = "Connect wallet first";
        return;
      }

      try {
        const contract = new ethers.Contract(contractAddress, abi, signer);
        const tx = await contract.gm();
        document.getElementById("status").innerText = `GM sent! TX: ${tx.hash}`;
      } catch (err) {
        console.error(err);
        document.getElementById("status").innerText = `Failed to send GM: ${err.message}`;
      }
    }
  </script>
</body>
</html>
